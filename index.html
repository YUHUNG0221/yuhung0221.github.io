<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 æ˜¥ç¯€æ’ç­æ„é¡˜è¡¨</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background-color: #f8f9fa; }
        .container { max-width: 800px; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .date-row { border-bottom: 1px solid #eee; padding: 10px 0; align-items: center; }
        .date-label { font-weight: bold; color: #333; }
        .weekend { color: #d9534f; } /* é€±æœ«é¡¯ç¤ºç´…è‰² */
        
        /* éå¹´æœŸé–“çš„æ¨£å¼ */
        .holiday-row { background-color: #f2f2f2; color: #999; }
        .holiday-label { opacity: 0.6; }
        
        .loading { display: none; text-align: center; margin-top: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h2 class="text-center mb-4">ğŸ“… 2026 æ’ç­æ„é¡˜èª¿æŸ¥</h2>
    <p class="text-muted text-center">æ—¥æœŸç¯„åœï¼š2026/1/19 ~ 2026/2/22</p>

    <div class="mb-3">
        <label for="username" class="form-label">è«‹è¼¸å…¥ä½ çš„å§“åï¼š</label>
        <input type="text" class="form-control" id="username" placeholder="ç‹å°æ˜" required>
    </div>

    <hr>
    <h5>è«‹å‹¾é¸å¯ä¸Šç­æ—¥æœŸèˆ‡æ™‚é–“ï¼š</h5>
    <div id="schedule-container">
        </div>

    <hr class="mt-4">
    <div class="mb-4">
        <label for="remarks" class="form-label fw-bold">ğŸ“ å‚™è¨»äº‹é … (é¸å¡«)</label>
        <textarea class="form-control" id="remarks" rows="3" placeholder="ä¾‹å¦‚ï¼šæˆ‘æƒ³ç›¡é‡é€£çºŒä¸Šä¸€æ•´å¤©ã€ä¸€é€±æœ€å¤šæ’ 3 å¤©ç­ã€å¸Œæœ›ä¸è¦æ’æ—©ç­...ç­‰"></textarea>
    </div>

    <div class="d-grid gap-2">
        <button class="btn btn-primary btn-lg" onclick="submitData()">ç¢ºèªé€å‡º</button>
    </div>
    
    <div id="loading" class="loading">
        <div class="spinner-border text-primary" role="status"></div>
        <p>è³‡æ–™å‚³é€ä¸­...</p>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } 
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBXyBEURDETH9tVc5F4HGG6KmwSpYGOFb4",
      authDomain: "winter-aab3a.firebaseapp.com",
      projectId: "winter-aab3a",
      storageBucket: "winter-aab3a.firebasestorage.app",
      messagingSenderId: "46516471666",
      appId: "1:46516471666:web:113f81a88048b0bd1a7feb",
      measurementId: "G-V4QQHXR218"
    };

    // åˆå§‹åŒ– Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // -----------------------------------------------------------
    // ç¨‹å¼é‚è¼¯å€
    // -----------------------------------------------------------
    
    const container = document.getElementById('schedule-container');
    const startDate = new Date('2026-01-19');
    const endDate = new Date('2026-02-22');
    
    // å®šç¾©éå¹´å€é–“
    const cnyStart = new Date('2026-02-11');
    const cnyEnd = new Date('2026-02-20');

    const weekDays = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];

    // 1. è‡ªå‹•ç”¢ç”Ÿæ—¥æœŸåˆ—è¡¨
    let currentDate = new Date(startDate);
    while (currentDate <= endDate) {
        const dateStr = currentDate.toISOString().split('T')[0]; // YYYY-MM-DD
        const month = currentDate.getMonth() + 1;
        const day = currentDate.getDate();
        const weekDay = currentDate.getDay();
        const isWeekend = (weekDay === 0 || weekDay === 6);

        // åˆ¤æ–·æ˜¯å¦ç‚ºéå¹´æœŸé–“
        const isCNY = (currentDate >= cnyStart && currentDate <= cnyEnd);
        
        const rowClass = isCNY ? 'holiday-row' : '';
        const disabledAttr = isCNY ? 'disabled' : '';
        const labelExtra = isCNY ? '<span class="badge bg-danger ms-2">ğŸ§§ éå¹´å…¬ä¼‘</span>' : '';
        const labelClass = isCNY ? 'holiday-label' : (isWeekend ? 'weekend' : '');

        const rowHtml = `
            <div class="row date-row ${rowClass}">
                <div class="col-md-3 col-4">
                    <span class="date-label ${labelClass}">
                        ${month}/${day} (${weekDays[weekDay]})
                    </span>
                    ${labelExtra}
                </div>
                <div class="col-md-9 col-8">
                    <div class="input-group">
                        <div class="input-group-text">
                            <input class="form-check-input mt-0 is-available" 
                                   type="checkbox" 
                                   onchange="toggleInputs(this)" 
                                   ${disabledAttr}>
                        </div>
                        <input type="time" class="form-control start-time" value="09:00" disabled>
                        <span class="input-group-text">è‡³</span>
                        <input type="time" class="form-control end-time" value="18:00" disabled>
                        <input type="hidden" class="date-val" value="${dateStr}">
                    </div>
                </div>
            </div>
        `;
        container.insertAdjacentHTML('beforeend', rowHtml);
        currentDate.setDate(currentDate.getDate() + 1);
    }

    // 2. åˆ‡æ›æ™‚é–“è¼¸å…¥æ¡†çš„å•Ÿç”¨ç‹€æ…‹
    window.toggleInputs = function(checkbox) {
        const parent = checkbox.closest('.row');
        const inputs = parent.querySelectorAll('input[type="time"]');
        inputs.forEach(input => input.disabled = !checkbox.checked);
    }

    // 3. é€å‡ºè³‡æ–™åˆ° Firebase
    window.submitData = async function() {
        const name = document.getElementById('username').value.trim();
        // æŠ“å–å‚™è¨»å…§å®¹
        const remarks = document.getElementById('remarks').value.trim();

        if (!name) {
            alert('æ‹œè¨—å¯«ä¸€ä¸‹åå­—å•¦ï¼');
            return;
        }

        const availability = [];
        const rows = document.querySelectorAll('.date-row');
        
        rows.forEach(row => {
            const checkbox = row.querySelector('.is-available');
            if (checkbox.checked && !checkbox.disabled) {
                availability.push({
                    date: row.querySelector('.date-val').value,
                    startTime: row.querySelector('.start-time').value,
                    endTime: row.querySelector('.end-time').value
                });
            }
        });

        if (availability.length === 0) {
            if(!confirm('ä½ ä¸€å¤©éƒ½æ²’æœ‰å‹¾é¸å–”ï¼Ÿç¢ºå®šè¦é€å‡ºç©ºç™½ç­è¡¨å—ï¼Ÿ')) return;
        }

        document.getElementById('loading').style.display = 'block';

        try {
            await addDoc(collection(db, "schedules"), {
                name: name,
                availability: availability,
                remarks: remarks, // å°‡å‚™è¨»æ¬„ä½ä¸€ä½µä¸Šå‚³
                submittedAt: serverTimestamp()
            });
            
            alert('âœ… æ„Ÿè¬ï¼ä½ çš„ç­è¡¨ (å«å‚™è¨») å·²æˆåŠŸé€å‡ºã€‚');
            location.reload(); 
        } catch (e) {
            console.error("Error adding document: ", e);
            alert('âŒ ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æˆªåœ–çµ¦é–‹ç™¼è€…ï¼š' + e.message);
        } finally {
            document.getElementById('loading').style.display = 'none';
        }
    }
</script>

</body>
</html>