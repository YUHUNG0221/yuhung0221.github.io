<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 å¯’å‡æ’ç­æ„é¡˜è¡¨</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #4a90e2;
            --bg-color: #f0f2f5;
            --card-radius: 16px;
            
            /* --- ğŸ¨ é…è‰²ç³»çµ± --- */
            /* 1. éå¹´ (CNY) - å–œæ°£ç´…é‡‘é…è‰² */
            --cny-bg-light: #fffcf5; 
            --cny-border: #ff4b2b;   
            --cny-text: #c0392b;     
            --cny-gradient: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);

            /* 2. é€±æœ« (Weekend) - æ”¾é¬†æ«»èŠ±ç²‰ */
            --wk-bg-light: #fffbfb;
            --wk-border: #e056fd;
            --wk-text: #b33771;
        }

        body { 
            padding: 20px; 
            background-color: var(--bg-color); 
            font-family: 'Noto Sans TC', sans-serif; 
            color: #444;
        }

        .container { max-width: 800px; padding: 0; }

        /* --- ğŸ“ å¡«å¯«è¡¨å–®å€ --- */
        .form-card { 
            background: white; 
            padding: 30px; 
            border-radius: var(--card-radius); 
            box-shadow: 0 8px 30px rgba(0,0,0,0.05); 
        }

        .date-row { 
            background: white; border: 1px solid #eee; border-radius: 12px; padding: 18px 20px; 
            margin-bottom: 15px; transition: all 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.02);
            position: relative; overflow: hidden;
        }
        .date-row:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.08); }

        /* å‡æ—¥æ¨£å¼ */
        .row-weekend { 
            background-color: #fff8fc; 
            border-left: 5px solid var(--wk-border); 
        }
        .row-weekend .date-label { color: var(--wk-text); }

        /* éå¹´æ¨£å¼ - å¼·èª¿ */
        .row-cny { 
            background-color: var(--cny-bg-light) !important; 
            border: 2px solid var(--cny-border); 
            box-shadow: 0 4px 12px rgba(255, 75, 43, 0.15);
        }
        .row-cny .date-label { 
            color: var(--cny-text); font-weight: 800; font-size: 1.15rem; 
            display: flex; align-items: center; gap: 5px;
        }
        .cny-badge { 
            background: var(--cny-gradient); color: white; padding: 2px 8px; 
            border-radius: 4px; font-size: 0.8rem; box-shadow: 0 2px 4px rgba(0,0,0,0.2); 
        }

        .form-check-input { width: 1.5em; height: 1.5em; margin-top: 0.1em; cursor: pointer; border-color: #ccc;}
        .form-check-input:checked { background-color: var(--primary-color); border-color: var(--primary-color); }
        .form-select { border-radius: 8px; border: 1px solid #e0e0e0; padding: 8px 12px; cursor: pointer; }
        
        .loading { display: none; text-align: center; margin-top: 20px; color: #888; }
        .btn-primary { 
            background-color: var(--primary-color); border: none; padding: 12px 20px; 
            box-shadow: 0 4px 10px rgba(74, 144, 226, 0.3); transition: 0.2s; 
        }
        .btn-primary:hover { background-color: #357abd; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(74, 144, 226, 0.4); }
    </style>
</head>
<body>

<div class="container">
    <div class="form-card">
        <div class="text-center mb-4">
            <h2 class="fw-bold" style="color: #333;">â›„ 2026 å¯’å‡æ’ç­æ„é¡˜è¡¨</h2>
            <p class="text-muted">èª¿æŸ¥æœŸé–“ï¼š2026/1/19 ~ 2026/2/22</p>
        </div>

        <div class="mb-4">
            <label class="form-label fw-bold">ä½ çš„å§“å</label>
            <input type="text" class="form-control form-control-lg bg-light border-0" id="username" placeholder="è«‹è¼¸å…¥æœ¬å (ä¾‹å¦‚: ç‹å°æ˜)" required>
        </div>
        
        <div class="d-flex align-items-center gap-2 mb-4 p-3 bg-light rounded-3 text-secondary">
            <span style="font-size: 1.2rem;">ğŸ’¡</span>
            <small>é è¨­æ™‚é–“ï¼šå¹³æ—¥ 13:00~23:00 / å‡æ—¥ 09:00~23:00 (å¯æ‰‹å‹•èª¿æ•´)</small>
        </div>
        
        <div id="schedule-container"></div>
        
        <hr class="my-5 text-muted opacity-25">
        
        <div class="mb-4">
            <label class="form-label fw-bold">ğŸ“ å‚™è¨» (é¸å¡«)</label>
            <textarea class="form-control bg-light border-0" id="remarks" rows="3" placeholder="ä¾‹å¦‚ï¼šå¸Œæœ›é€£ä¸Šæ—©åˆæ™šç­ã€ç›¡é‡æ’æ•´å¤©ã€æˆ–æ˜¯åªæƒ³ä¸Šæ™šç­..."></textarea>
        </div>
        <div class="d-grid gap-2 mb-2">
            <button class="btn btn-primary btn-lg rounded-pill fw-bold" onclick="submitData()">ç¢ºèªé€å‡ºç­è¡¨</button>
        </div>
        
        <div id="loading" class="loading">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2 small">è³‡æ–™ä¸Šå‚³ä¸­...</p>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } 
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // -----------------------------------------------------------
    // â˜…â˜…â˜… è«‹è¨˜å¾—æ›å›ä½ çš„ Firebase Config â˜…â˜…â˜…
    // -----------------------------------------------------------
    const firebaseConfig = {
      apiKey: "AIzaSyBXyBEURDETH9tVc5F4HGG6KmwSpYGOFb4",
      authDomain: "winter-aab3a.firebaseapp.com",
      projectId: "winter-aab3a",
      storageBucket: "winter-aab3a.firebasestorage.app",
      messagingSenderId: "46516471666",
      appId: "1:46516471666:web:113f81a88048b0bd1a7feb",
      measurementId: "G-V4QQHXR218"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const startDate = new Date('2026-01-19');
    const endDate = new Date('2026-02-22');
    const cnyStart = new Date('2026-02-11');
    const cnyEnd = new Date('2026-02-20');

    // åˆå§‹åŒ–è¡¨å–®
    function initForm() {
        const container = document.getElementById('schedule-container');
        let currentDate = new Date(startDate);
        
        while (currentDate <= endDate) {
            const dateStr = currentDate.toISOString().split('T')[0];
            const month = currentDate.getMonth() + 1;
            const day = currentDate.getDate();
            const weekDay = currentDate.getDay(); 
            const weekDaysStr = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
            
            const isWeekend = (weekDay === 0 || weekDay === 6);
            const isCNY = (currentDate >= cnyStart && currentDate <= cnyEnd);
            
            let defaultStartTime = isWeekend ? "09:00" : "13:00";
            let defaultEndTime = "23:00";
            const disabledAttr = isCNY ? 'disabled' : '';
            
            let rowClass = '';
            let labelExtra = '';
            if (isCNY) {
                rowClass = 'row-cny'; 
                labelExtra = '<span class="cny-badge">ğŸ§§ éå¹´å…¬ä¼‘</span>';
            } else if (isWeekend) {
                rowClass = 'row-weekend';
                labelExtra = '<span class="badge text-secondary border ms-2">å‡æ—¥</span>';
            }

            const startOptions = generateTimeOptions(defaultStartTime);
            const endOptions = generateTimeOptions(defaultEndTime);

            const rowHtml = `
                <div class="row date-row align-items-center ${rowClass}">
                    <div class="col-12 col-md-4 d-flex align-items-center mb-2 mb-md-0">
                        <div class="form-check mb-0">
                            <input class="form-check-input is-available" type="checkbox" onchange="toggleInputs(this)" ${disabledAttr} id="chk-${dateStr}">
                            <label class="form-check-label ms-2 date-label" for="chk-${dateStr}">${month}/${day} (${weekDaysStr[weekDay]})</label>
                        </div>
                        ${labelExtra}
                    </div>
                    <div class="col-12 col-md-8">
                        <div class="d-flex align-items-center gap-2">
                            <select class="form-select start-time" disabled>${startOptions}</select>
                            <span class="text-muted">~</span>
                            <select class="form-select end-time" disabled>${endOptions}</select>
                            <input type="hidden" class="date-val" value="${dateStr}">
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', rowHtml);
            currentDate.setDate(currentDate.getDate() + 1);
        }
    }

    function generateTimeOptions(sel) {
        let h = '';
        for (let i = 8; i <= 24; i++) {
            let hr = i < 10 ? `0${i}` : i;
            let t = `${hr}:00`; if (i===24) t="00:00 (éš”æ—¥)";
            h += `<option value="${t}" ${t.startsWith(sel)?'selected':''}>${t}</option>`;
            if (i!==24) { let ht=`${hr}:30`; h+=`<option value="${ht}" ${ht===sel?'selected':''}>${ht}</option>`; }
        }
        return h;
    }

    window.toggleInputs = function(chk) {
        const p = chk.closest('.row');
        p.querySelectorAll('select').forEach(s => s.disabled = !chk.checked);
    }

    window.submitData = async function() {
        const name = document.getElementById('username').value.trim();
        const remarks = document.getElementById('remarks').value.trim();
        
        if (!name) { alert('è«‹å¡«å¯«å§“åï¼'); return; }
        
        const availability = [];
        document.querySelectorAll('.date-row').forEach(row => {
            const chk = row.querySelector('.is-available');
            if (chk.checked && !chk.disabled) {
                availability.push({
                    date: row.querySelector('.date-val').value,
                    startTime: row.querySelector('.start-time').value,
                    endTime: row.querySelector('.end-time').value
                });
            }
        });

        if (availability.length === 0) {
            if(!confirm('ç›®å‰æœªå‹¾é¸ä»»ä½•æ—¥æœŸï¼Œç¢ºå®šè¦é€å‡ºç©ºç™½ç­è¡¨å—ï¼Ÿ')) return;
        }

        const load = document.getElementById('loading');
        load.style.display = 'block';

        try {
            await addDoc(collection(db, "schedules"), { 
                name: name, 
                availability: availability, 
                remarks: remarks, 
                submittedAt: serverTimestamp() 
            });
            alert('âœ… é€å‡ºæˆåŠŸï¼æ„Ÿè¬ä½ çš„å¡«å¯«ã€‚');
            location.reload(); 
        } catch (e) { 
            console.error(e); 
            alert('âŒ ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ï¼š' + e.message); 
        } finally { 
            load.style.display = 'none'; 
        }
    }

    // å•Ÿå‹•ç¨‹å¼
    initForm();
</script>

</body>
</html>
